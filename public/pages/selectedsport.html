<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Select Sport: Basket</title>
    <link rel="stylesheet" href="../styles/navbar.css" />
    <link rel="stylesheet" href="../styles/eventcard.css" />
    <link rel="stylesheet" href="../styles/leaguecard.css" />
    <link rel="stylesheet" href="../styles/selectedsport.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-logo">
        <img src="../assets/icons/icon_logo.svg" />
        <span>BeyondSports</span>
      </div>
      <div class="nav-search">
        <input type="text" placeholder="Search for anything" />
      </div>
      <ul class="nav-links">
        <li><a href="#">Home</a></li>
        <li><a href="#">My Events</a></li>
        <li><a href="#">My Leagues</a></li>
        <li><a href="#">Contacts</a></li>
      </ul>
      <div class="nav-create">
        <button class="dropbtn">Create</button>
        <div class="dropdown-content">
          <a href="#">Event</a>
          <a href="#">League</a>
        </div>
      </div>
    </nav>

    <div class="selected-sport-title">
      <h1>Selected Sport: Basket</h1>
    </div>

    <div class="selected-sport-title">
      <h2>Events Near You</h2>
    </div>

    <div class="events-container">
      <!-- First event card -->
      <div class="event-card">
        <div class="event-card-picture">
          <img src="../assets/images/basket1.png" />
        </div>
        <div class="event-card-content">
          <div class="event-card-title">Basket Pick Up - Mix</div>
          <div class="event-card-organizer">
            <img src="../assets/icons/icon_person.svg" class="icon" />Zeid Solh
          </div>
          <div class="event-card-location">
            <img src="../assets/icons/icon_map.svg" class="icon" />RSF
          </div>
          <div class="event-card-description">
            Come take a break from your midterms and play some Basket with our
            team leader Zeid.
          </div>
          <hr class="card-divider" />
          <div class="event-card-time">
            <p>Time</p>
            <div class="time-shape">7:30PM</div>
          </div>
          <div class="event-card-rsvp">RSVP</div>
        </div>
      </div>

      <!-- Second event card -->
      <div class="event-card">
        <div class="event-card-picture">
          <img src="../assets/images/basket2.png" />
        </div>
        <div class="event-card-content">
          <div class="event-card-title">Basket Pick Up - Mix</div>
          <div class="event-card-organizer">
            <img src="../assets/icons/icon_person.svg" class="icon" />Zeid Solh
          </div>
          <div class="event-card-location">
            <img src="../assets/icons/icon_map.svg" class="icon" />RSF
          </div>
          <div class="event-card-description">
            Come take a break from your midterms and play some Basket with our
            team leader Zeid.
          </div>
          <hr class="card-divider" />
          <div class="event-card-time">
            <p>Time</p>
            <div class="time-shape">7:30PM</div>
          </div>
          <div class="event-card-rsvp">RSVP</div>
        </div>
      </div>

      <!-- Third event card -->
      <div class="event-card">
        <div class="event-card-picture">
          <img src="../assets/images/basket3.png" />
        </div>
        <div class="event-card-content">
          <div class="event-card-title">Basket Pick Up - Mix</div>
          <div class="event-card-organizer">
            <img src="../assets/icons/icon_person.svg" class="icon" />Zeid Solh
          </div>
          <div class="event-card-location">
            <img src="../assets/icons/icon_map.svg" class="icon" />RSF
          </div>
          <div class="event-card-description">
            Come take a break from your midterms and play some Basket with our
            team leader Zeid.
          </div>
          <hr class="card-divider" />
          <div class="event-card-time">
            <p>Time</p>
            <div class="time-shape">7:30PM</div>
          </div>
          <div class="event-card-rsvp">RSVP</div>
        </div>
      </div>
    </div>

    <div class="selected-sport-title">
      <h2>Leagues Near You</h2>
    </div>

    <div class="league-container">
      <div class="league-card">
        <img src="../assets/images/league1.png" />
        <div class="league-info">
          <h3>PowerUp League</h3>
          <p>April 7-16</p>
        </div>
      </div>

      <div class="league-card">
        <img src="../assets/images/league2.png" />
        <div class="league-info">
          <h3>Hoopers League</h3>
          <p>April 9-11</p>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Fetch events
        fetch("/events")
          .then((response) => response.json())
          .then((events) => updateEvents(events))
          .catch((error) => console.error("Error fetching events:", error));

        // Fetch leagues
        fetch("/leagues")
          .then((response) => response.json())
          .then((leagues) => updateLeagues(leagues))
          .catch((error) => console.error("Error fetching leagues:", error));

        function updateEvents(events) {
          const container = document.querySelector(".events-container");
          container.innerHTML = ""; // Clear existing content
          events.forEach((event) => {
            const eventHtml = `
                      <div class="event-card">
                          <div class="event-card-picture">
                              <img src="${
                                event.imageUrl || "../assets/images/default.png"
                              }" />
                          </div>
                          <div class="event-card-content">
                              <div class="event-card-title">${
                                event.eventName
                              }</div>
                              <div class="event-card-organizer">
                                  <img src="../assets/icons/icon_person.svg" class="icon" />${
                                    event.organizer || "Zeid Solh"
                                  }
                              </div>
                              <div class="event-card-location">
                                  <img src="../assets/icons/icon_map.svg" class="icon" />${
                                    event.address
                                  }, ${event.city}
                              </div>
                              <div class="event-card-description">${
                                event.description
                              }</div>
                              <hr class="card-divider" />
                              <div class="event-card-time">
                                  <p>Time</p>
                                  <div class="time-shape">${
                                    event.eventTime
                                  }</div>
                              </div>
                              <div class="event-card-rsvp">RSVP</div>
                          </div>
                      </div>
                  `;
            container.insertAdjacentHTML("beforeend", eventHtml);
          });
        }

        function updateLeagues(leagues) {
          const leagueContainer = document.querySelector(".league-container");
          leagueContainer.innerHTML = ""; // Clear existing content
          leagues.forEach((league) => {
            const leagueHtml = `
                      <div class="league-card">
                          <img src="${
                            league.imageUrl ||
                            "../assets/images/default_league.png"
                          }" />
                          <div class="league-info">
                              <h3>${league.leagueName}</h3>
                              <p>${league.eventDates}</p>
                          </div>
                      </div>
                  `;
            leagueContainer.insertAdjacentHTML("beforeend", leagueHtml);
          });
        }
      });


      //TODO: need to change textContent to correct db query
      document.addEventListener("DOMContentLoaded", function (event) {
        all_events = document.querySelectorAll(".event-card");
        all_events.forEach((event) => {
          event.addEventListener("click", function (event) {
            const eventName = encodeURIComponent(event.querySelector(".event-name").textContent);
            const eventDate = encodeURIComponent(event.querySelector(".event-date").textContent);
            const eventOrganizer = encodeURIComponent(event.querySelector(".event-organizer").textContent);
            const eventLocation = encodeURIComponent(event.querySelector(".event-location").textContent);
            const eventSpots = encodeURIComponent(event.querySelector(".event-spots").textContent);
            const eventDescription = encodeURIComponent(event.querySelector(".event-description").textContent);

            window.location.href = "event_opened.html?name=${eventName}&date=${eventDate}&organizer=${eventOrganizer}&location=${eventLocation}&spots=${eventSpots}&description=${eventDescription}";
          });
        });
      });

      //TODO: need to make sure that each league card leads to its specific league page and also updates the league page with the correct league information
      document.addEventListener("DOMContentLoaded", function (event) {
        all_events = document.querySelectorAll(".league-card");
        all_events.forEach((event) => {
          event.addEventListener("click", function (event) {
            window.location.href = "event_opened.html"; //TODO: need to change this to league_opened.html
        });
      });
      })
    </script>
  </body>
</html>
