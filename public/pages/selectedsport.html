<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Select Sport: Basket</title>
    <link rel="stylesheet" href="../styles/navbar.css" />
    <link rel="stylesheet" href="../styles/eventcard.css" />
    <link rel="stylesheet" href="../styles/leaguecard.css" />
    <link rel="stylesheet" href="../styles/selectedsport.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-logo">
        <img src="../assets/icons/icon_logo.svg" />
        <span>BeyondSports</span>
      </div>
      <div class="nav-search">
        <input type="text" placeholder="Search for anything" />
      </div>
      <ul class="nav-links">
        <li><a href="#">Home</a></li>
        <li><a href="#">My Events</a></li>
        <li><a href="#">My Leagues</a></li>
        <li><a href="#">Contacts</a></li>
      </ul>
      <div class="nav-create">
        <button class="dropbtn">Create</button>
        <div class="dropdown-content">
          <a href="#">Event</a>
          <a href="#">League</a>
        </div>
      </div>
    </nav>

    <div class="selected-sport-title">
      <h1>Selected Sport: Basket</h1>
    </div>

    <div class="selected-sport-title">
      <h2>Events Near You</h2>
    </div>

    <div class="events-container"></div>

    <div class="selected-sport-title">
      <h2>Leagues Near You</h2>
    </div>

    <div class="league-container">
      <div class="league-card">
        <img src="../assets/images/league1.png" />
        <div class="league-info">
          <h3>PowerUp League</h3>
          <p>April 7-16</p>
        </div>
      </div>

      <div class="league-card">
        <img src="../assets/images/league2.png" />
        <div class="league-info">
          <h3>Hoopers League</h3>
          <p>April 9-11</p>
        </div>
      </div>
    </div>

    <script>
      //TODO: need to change textContent to correct db query

      //TODO: need to make sure that each league card leads to its specific league page and also updates the league page with the correct league information
      document.addEventListener("DOMContentLoaded", function (event) {
        all_events = document.querySelectorAll(".league-card");
        all_events.forEach((event) => {
          event.addEventListener("click", function (event) {
            window.location.href = "view_league.html";
          });
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const sportName = urlParams.get("sport");

        // Update the page title and header dynamically based on the sport
        document.title = `Select Sport: ${sportName}`;
        document.querySelector(
          ".selected-sport-title h1"
        ).textContent = `Selected Sport: ${sportName}`;

        // Fetch events for the given sport
        fetch(`/events/sport?sport=${encodeURIComponent(sportName)}`)
          .then((response) => response.json())
          .then((events) => {
            updateEvents(events);
            makeCardsClickable(); // Call to make cards clickable after they are created
          })
          .catch((error) => console.error("Error fetching events:", error));
      });

      function updateEvents(events) {
        const container = document.querySelector(".events-container");
        container.innerHTML = ""; // Clear existing content
        events.forEach((event) => {
          const eventHtml = `
      <div class="event-card" title="${event.id}">
        <div class="event-card-picture">
          <img src="${event.imageUrl || "../assets/images/default.png"}" />
        </div>
        <div class="event-card-content">
          <div class="event-card-title">${event.eventName}</div>
          <div class="event-card-organizer">
            <img src="../assets/icons/icon_person.svg" class="icon" />${
              event.organizer || "N/A"
            }
          </div>
          <div class="event-card-location">
            <img src="../assets/icons/icon_map.svg" class="icon" />${
              event.address
            }, ${event.city}
          </div>
          <div class="event-card-description">${event.description}</div>
          <hr class="card-divider" />
          <div class="event-card-time">
            <p>Time</p>
            <div class="time-shape">${event.eventTime}</div>
          </div>
          <div class="event-card-rsvp">RSVP</div>
        </div>
      </div>
    `;
          container.insertAdjacentHTML("beforeend", eventHtml);
        });
      }

      function makeCardsClickable() {
        const all_events = document.querySelectorAll(".event-card");
        all_events.forEach((card) => {
          card.addEventListener("click", function () {
            const eventId = this.getAttribute("title"); // Use 'this' to refer to the card
            window.location.href = `event_opened.html?id=${eventId}`;
          });
        });
      }
    </script>
  </body>
</html>
